\documentclass[handout, 12pt]{beamer}
%\documentclass[11pt]{beamer}

% \tiny\scriptsize\footnotesize\small\normalsize\large\Large\LARGE\huge\Huge

\input{preamble.tex}
\title[]{Latent Variable Methods for Batch Processes}
\subtitle[]{Learning from data}
\author[]{Instructor: Kevin Dunn \\{\tt kevin.dunn@connectmv.com}\\ http://connectmv.com}
\institute[]{}
\date[]{Course notes \copyright~ ConnectMV, Inc. \\ \vspace{1cm}{\footnotesize Presented at GSK, Mississauga, February 2011}}

\begin{document}
\begin{frame}
\titlepage
\end{frame}

\begin{frame}\frametitle{TODO}

	% High t1: lower JTempSP slope:  But, JtempSlope is between -0.15 and -0.05, so a lower JTempSlope implies 
	% operation toward -0.15, ie temperature decreases more rapidly for the good batches. This might appear conflicting with the w*1 line plot, which shows that higher values of temperature SP lead to better batches.  How can a batch with a steeper decreasing slope have high value of temperature SP?  Well, the key insight is that temperature SP is always going to END at the same temperature value at the end of phase 2.  Having a steeper, more negative slope, implies that the batch must start at a higher temperature earlier in the batch.  This agrees exactly with the w*1 line plot.
	% 
	% % To get:
	% R2X = ??, R2Y = ??, Q2Y = ?? for fullbatch analysis of FMC
	% 
	% ------------------------
	% 
	% List of figures
	% 
	% 1. Nature of batch data
	% 2. 4 trajectories from FMC
	% 3. PCA scores from the Y's
	% 4. DuPont Nylong data: 10 trajectories from a batch
	% 5. Z X and Y for landmarks (with dimensions)
	% 6. VIP plot for the PLS model 
	% 7. The PLS score plot for landmarks PLS model
	% 8. The PLS loadings plot for landmarks PLS model
	% 9. Unfolding the data: two ways
	% 10. Variance to be explained from the 2 unfoldings
	% 11 *. Collect and other variables : show how alignment happens
	% 12 *. Time utiliziation during the batch
	% 13. General structure of batch-wise unfolded data
	% 14. t1-t2 score plot for batch PLS
	% 15 w1 loading plot for PLS
	% 16. contribution plot between 2 batches

	% \section{The final words}
	% 
	% \begin{frame}\frametitle{Final words}
	% 	\vspace{3pt}
	% 
	% 	{\color{myOrange}\bf The three main sources of errors are due to:}
	% 	\begin{enumerate}
	% 		\item {\bf The modeller:} model formulation errors
	% 		\item {\bf The algorithm:} truncation/discretization errors
	% 		\item {\bf The computer:} round-off errors
	% 	\end{enumerate}
	% 
	% 	\begin{columns}
	% 		\column{.80\textwidth}
	% 		\begin{exampleblock}{}
	% 			\centering{In engineering applications, use \alert{double-precision or better} to mitigate the effect of round-off error}
	% 		\end{exampleblock}
	% 	\end{columns}
	% 
	% 	\vspace{5pt}
	% 	\visible<2->{
	% 		\begin{columns}
	% 			\column{.34\textwidth}
	% 
	% 			\column{.65\textwidth}
	% 			\alert{\bf Reading:}\\
	% 			\vspace{3pt}
	% 			\begin{itemize}
	% 				\item Chapter 3 in S. C. Chapra, and R. P. Canale, {\em ``Numerical Methods for Engineers''}, McGraw Hill, 5th/6th Edition
	% 				\item Wikipedia article on \textbf{\texttt{Floating point}} is well-written
	% 				\item \href{http://docs.sun.com/source/806-3568/ncg_goldberg.html}{What every computer scientist should know about floating-point arithmetic}
	% 			\end{itemize}
	% 		\end{columns}
	% 	}
	% \end{frame}


\begin{itemize}
	\item	Adjust interline spacing  \hfill {\color{myOrange} $\leftarrow$ typical in practice!}
\end{itemize}
\end{frame}

\begin{frame}\frametitle{Interpreting score plots: \(t_1, t_2, \ldots \)}

\begin{itemize}
	\item	Shown as scatter plot or time-series plot

	\item	Each point in plot is an observation

	\item	\(t_1\) explains more than \(t_2\); i.e. pay more attention to lower scores

		\begin{itemize}
			\item	observations that are similar appear close together in all scores
			\item	\emph{colour code} score plots by another variables: makes plot more informative
		\end{itemize}

	\item	look for \textbf{clusters} and \textbf{patterns} to learn from data
\end{itemize}
\end{frame}

\begin{frame}\frametitle{Interpreting loading plots: \( p_1, p_2, \ldots \)}

\begin{itemize}
	\item	Shown as bar plots or scatter plots

	\item 	One point per variable in the model
	
		\begin{itemize}
			\item value of: \(\pm 0.8 vs \pm 0.6\) are both important
			\item value of: \(\pm 0.3 vs \pm 0.1\) are both quite small			
		\end{itemize}

	\item 	Each point in plot is an observation

	\item 	\(t_1\) explains more than \(t_2\); i.e. pay more attention to lower scores

		\begin{itemize}
			\item	observations that are similar appear close together in all scores
			\item 	\emph{colour code} score plots by another variables ] makes plot more informative
		\end{itemize}

	\item 	look for \textbf{clusters} and \textbf{patterns} to learn from data
\end{itemize}
\end{frame}

%-------------------------------------------------
\begin{frame}\frametitle{Outline}
\tableofcontents
\end{frame}
%-------------------------------------------------

%\input{batch-course-part-A.tex}

%-------------------------------------------------
\section{Batch analysis via direct PCA and PLS}
%-------------------------------------------------

\begin{frame}\frametitle{Batch systems: simple definition}

\begin{exampleblock}{Simplest definition}
\centering{\large{\textbf{A batch system}: group of the \alert{\emph{same variables}}, gathered over a period of \alert{\emph{time}}}}
\end{exampleblock}
	
\begin{center}
	\includegraphics[width=6cm]{images/batch-system.png}	
\end{center}

\end{frame}	

\begin{frame}\frametitle{Batch systems: changing relationship}

	\textbf{Batch system}: group of the \emph{same variables}, gathered over a period of \emph{time}.  Why not just use ordinary PCA or PLS:

	\begin{center}
		\includegraphics[width=2.4cm]{images/batch-illustrate-unusual-unfolding.png}
	\end{center}


	\begin{itemize}
		\item 	PCA is invariant to row order: 
		\begin{itemize}			
			\item	can shuffle rows, still get same model
			\item 	explain how rows are related to each other
			\item 	each row is assumed independent of the others
			\item 	summarize relationship between variables (columns)
		\end{itemize}
	\end{itemize}

	\begin{exampleblock}{Key issue}
	In \textbf{batch systems}: relationship between variables \alert{changes during the batch}
	\end{exampleblock}
\end{frame}

\begin{frame}\frametitle{Batch systems: changing relationship}

\begin{enumerate}
	\item Relationship between variables change within a batch 
			\begin{itemize}
				\item 	Entry and exit temperatures in a batch dryer correlate (move together) at the end of the batch. 
				\item 	At start of the batch there is little relationship: heat used to evaporate moisture	
			\end{itemize}\pause

	
	\item Past history of a batch affects future behaviour (``integrating system'')
	
			\begin{itemize}
				\item 	Unfold batch data as shown above: cannot capture that ``past effect'' on future rows.  Why?
				\item  	Recall: each row is independent in PCA and PLS
			\end{itemize}

\end{enumerate}
\end{frame}

\begin{frame}\frametitle{Batch systems: changing relationship}
\begin{enumerate}
	\setcounter{enumi}{2}
	\item 	Predictive modelling is harder by unfolding this way

			\begin{center}
				\includegraphics[width=3.5cm]{images/batch-illustrate-unusual-unfolding-with-Y.png}
			\end{center}
			
		
			\begin{itemize}
				\item 	What do we use as the \( \mathbf{Y} \) matrix in this case? {\scriptsize We don't have  \( \mathbf{Y} \) values at each time step.}
				\item 	Many elaborate schemes proposed in literature.			
			\end{itemize}
		
	\item 	Simple solution: arrange data so that each batch is within a row
	
			\begin{itemize}
				\item 	There are some issues with this  (alignment, real-time monitoring)
				\item 	In general, these issues can be addressed effectively
			\end{itemize}
\end{enumerate}
\end{frame}

\begin{frame}\frametitle{Analysis and learning from batch data}

	\begin{exampleblock}{Approach}
	Unfold the aligned batch data row wise, one batch per row, and use PCA and PLS directly.
	\end{exampleblock}

	\begin{center}
		\includegraphics[width=8cm]{images/batch-data-unfolding-X-only.png}	
	\end{center}
\end{frame}	

\begin{frame}\frametitle{DuPont Nylon example: learning from new data}

	\begin{itemize}
		\item	Industrial data set of \( N = 55 \) batches from Nylon production
		
		\item	Temperature, pressure and flow rate variables: \( K = 10\)  batch tags
		
		\item	Batch duration about 2 hours (\( J=100 \) time intervals)
		
		\item	12 hours before lab values returned: batch-to-batch adjustment not possible
		
		\item	Known problems with batches: 40, 41, 42, 50, 51, 53, 54, 55
	\end{itemize}
	
	
\end{frame}

\begin{frame}\frametitle{DuPont Nylon example: raw data}
	{\color{myGreen}{Note}}: data were scaled for confidentiality
	\begin{center}
		\includegraphics[width=\textwidth]{images/dupont/dupont-raw-data-trajectories.png}
	\end{center}
	
	\vspace{1cm}
	\begin{itemize}
		\item	Can see a few unusual batches: see ``Temp-C1'' and ``Press-1'' tags
		
		\item	Alignment looks pretty good (process is well controlled)
		
		\item	Some periods are noisy: ``Flow-1'' and ``Flow-2''
	\end{itemize}
\end{frame}

\begin{frame}\frametitle{DuPont Nylon example: initial PCA}
	\begin{itemize}

		\item	Just start with 2 components initially
		
				\begin{itemize}					
					\item	no cross-validation, just get a ``feel'' for the data
					\item	\( R^2_X = [38.28\%, 17.58\%]\), or cumulatively: 55.9\%
				\end{itemize}
		
		\item	Score plot:
				
				\begin{columns}
					\column{0.8\textwidth}
						\begin{center}
							\includegraphics[width=0.8\textwidth]{images/dupont/dupont-raw-score-plot.jpg}
							% batch_PCA = lvm({'X', batch_X}, 2);
							% plot(batch_PCA, 'scores', {'labels'})
						\end{center}
						
					\column{0.4\textwidth}
						\begin{itemize}
							\item	Batches 50 to 55 unusual
							
							\item	Distorted the model							
						\end{itemize}
				\end{columns}
	\end{itemize}
\end{frame}

\begin{frame}\frametitle{DuPont Nylon example: initial PCA}
	\begin{itemize}
		\item	SPE plot
	\end{itemize}
	
	\begin{center}
		\includegraphics[width=\textwidth]{images/dupont/dupont-raw-SPE.jpg}
		% batch_PCA = lvm({'X', batch_X}, 2);
		% plot(batch_PCA, 'spe', {'labels'})
	\end{center}
\end{frame}





\begin{frame}\frametitle{DuPont Nylon example: Summary}
	
\begin{enumerate}
	\item	Plot the trajectories
	
			\begin{itemize}
				\item	Sometime outlier batches already detectable
				
				\item	Visualize how good your alignment is: do data need extra pretreatment?
			\end{itemize}
\end{enumerate}


	
\end{frame}

%-------------------------------------------------
\section{Batch monitoring}
%-------------------------------------------------

%\input{batch-course-part-C.tex}

\end{document}

